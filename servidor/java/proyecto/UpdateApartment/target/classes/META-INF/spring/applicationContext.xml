<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:cxf="http://camel.apache.org/schema/cxf"
	xmlns:jaxrs="http://cxf.apache.org/jaxrs"
	xmlns:jee="http://www.springframework.org/schema/jee"
	xsi:schemaLocation="
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
       http://camel.apache.org/schema/cxf http://camel.apache.org/schema/cxf/camel-cxf.xsd
       http://cxf.apache.org/jaxrs http://cxf.apache.org/schemas/jaxrs.xsd
       http://www.springframework.org/schema/jee http://www.springframework.org/schema/jee/spring-jee.xsd
       http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd">


	<cxf:rsServer id="restService" address="/" serviceClass="com.proyecto.server.services.ServicioUserData">
		<cxf:providers>
			<bean class="com.fasterxml.jackson.jaxrs.json.JacksonJsonProvider" />
		</cxf:providers>
	</cxf:rsServer>
	
	
	<cxf:rsServer id="restServiceDelete" address="/Delete" serviceClass="com.proyecto.server.services.ServicioUserData">
		<cxf:providers>
			<bean class="com.fasterxml.jackson.jaxrs.json.JacksonJsonProvider" />
		</cxf:providers>
	</cxf:rsServer>
	
	
	<cxf:rsServer id="restServiceDeleteFavorito" address="/DeleteFavorito" serviceClass="com.proyecto.server.services.ServicioUserDataF">
		<cxf:providers>
			<bean class="com.fasterxml.jackson.jaxrs.json.JacksonJsonProvider" />
		</cxf:providers>
	</cxf:rsServer>
	
	<cxf:rsServer id="restServiceForgot" address="/Forgot" serviceClass="com.proyecto.server.services.ServicioUserData2">
		<cxf:providers>
			<bean class="com.fasterxml.jackson.jaxrs.json.JacksonJsonProvider" />
		</cxf:providers>
	</cxf:rsServer>
	
	<cxf:rsServer id="restServiceChange" address="/Change" serviceClass="com.proyecto.server.services.ServicioUserData2">
		<cxf:providers>
			<bean class="com.fasterxml.jackson.jaxrs.json.JacksonJsonProvider" />
		</cxf:providers>
	</cxf:rsServer>
	
	<cxf:rsServer id="restServiceComentario" address="/Comentario" serviceClass="com.proyecto.server.services.ServicioUserData">
		<cxf:providers>
			<bean class="com.fasterxml.jackson.jaxrs.json.JacksonJsonProvider" />
		</cxf:providers>
	</cxf:rsServer>
	
	<cxf:rsServer id="restServiceRegisterComentario" address="/RegisterComentario" serviceClass="com.proyecto.server.services.ServicioUserData3">
		<cxf:providers>
			<bean class="com.fasterxml.jackson.jaxrs.json.JacksonJsonProvider" />
		</cxf:providers>
	</cxf:rsServer>
	
	<cxf:rsServer id="restServiceFoto" address="/fotoUsuario" serviceClass="com.proyecto.server.services.ServicioUserData2">
		<cxf:providers>
			<bean class="com.fasterxml.jackson.jaxrs.json.JacksonJsonProvider" />
		</cxf:providers>
	</cxf:rsServer>
	
	<cxf:rsServer id="restServicePunto" address="/punto" serviceClass="com.proyecto.server.services.ServicioUserData4">
		<cxf:providers>
			<bean class="com.fasterxml.jackson.jaxrs.json.JacksonJsonProvider" />
		</cxf:providers>
	</cxf:rsServer>
	
	
	  <bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource"
		   destroy-method="close">
		   <property name="driverClassName" value="org.gjt.mm.mysql.Driver" />
		   <property name="url" value="jdbc:mysql://viewerrealm.cst0lr1fnijg.us-east-2.rds.amazonaws.com:3306/viewerrealmdb" />
		   <property name="username" value="RandyMarsh" />
		   <property name="password" value="thebestaround" />
  		</bean>
		
	<bean class="com.proyecto.server.sql.ConsultasBD" id="consultasBD" />
	<bean class="com.proyecto.server.sql.ConsultasBDelete" id="consultasBDelete" />
	<bean class="com.proyecto.server.sql.ConsultasBDeleteFavorito" id="consultasBDeleteFavorito" />
	<bean class="com.proyecto.server.sql.ConsultasForgot" id="CorreoConsultas" />
	<bean class="com.proyecto.server.sql.EliminarInmueble" id="EliminarInmueble" />
	<bean class="com.proyecto.server.sql.ConsultasComentarios" id="consultasComentarios" />
	<bean class="com.proyecto.server.sql.ConsultasComentarios2" id="consultasComentarios2" />
	<bean class="com.proyecto.server.sql.Updatefoto" id="updateFoto" />
	<bean class="com.proyecto.server.sql.Puntuacion" id="PuntuacionSer" />
	
	<bean id="correoProcessor4" class="com.proyecto.server.process.CorreoData4" />
	<bean id="correoProcessor3" class="com.proyecto.server.process.CorreoData3" />
	<bean id="correoProcessor2" class="com.proyecto.server.process.CorreoData2" />
	<bean id="processor" class="com.proyecto.server.process.ApartmentData" />
	<bean id="processorf" class="com.proyecto.server.process.ApartmentDataf" />
	<bean id="correoProcessor" class="com.proyecto.server.process.CorreoData" />
	<bean id="password" class="com.proyecto.server.process.Password" />
	<bean id="responseHandler" class="com.proyecto.server.process.ApartmentDataHandler" />
	<bean id="Handler" class="com.proyecto.server.process.DataHandler" />
	<bean id="mail" class="com.proyecto.server.process.mail" />

	<camelContext id="camelId" xmlns="http://camel.apache.org/schema/spring">
		
		
		<route id="myRoute">
			<from uri="cxfrs://bean://restService" />
			 <process ref="processor" />
			<choice>
				<when>
					<simple>${property.id} != null</simple>					
					<setHeader headerName="id">
						<simple>${property.id}</simple>
					</setHeader>
					<bean ref="consultasBD" />
					<setBody>
						<simple>update realizado exitosamente</simple>
					</setBody>
					<process ref="responseHandler" />
				</when>
				<otherwise>
					<setBody>
						<simple>error en el update</simple>
					</setBody>
					<process ref="responseHandler" />
				</otherwise>
			</choice>	
		</route>
		
		<route id="myRouteDelete">
			<from uri="cxfrs://bean://restServiceDelete" />
			 <process ref="processor" />
			<choice>
				<when>
					<simple>${property.id} != null</simple>					
					<setHeader headerName="id">
						<simple>${property.id}</simple>
					</setHeader>	
					<bean ref="consultasBDelete" />
					<setBody>
						<simple>delete realizado exitosamente</simple>
					</setBody>
					<process ref="responseHandler" />
				</when>
				<otherwise>
					<setBody>
						<simple>error en el delete</simple>
					</setBody>
					<process ref="responseHandler" />
				</otherwise>
			</choice>	
		</route>
		
		<route id="myRouteDeleteFavoritos">
			<from uri="cxfrs://bean://restServiceDeleteFavorito" />
			 <process ref="processorf" />
			<choice>
				<when>
					<simple>${property.id} != null</simple>					
					<setHeader headerName="id">
						<simple>${property.id}</simple>
					</setHeader>
					<setHeader headerName="correo">
						<simple>${property.correo}</simple>
					</setHeader>
					<bean ref="consultasBDeleteFavorito" />
					<setBody>
						<simple>delete realizado exitosamente</simple>
					</setBody>
					<process ref="responseHandler" />
				</when>
				<otherwise>
					<setBody>
						<simple>error en el delete</simple>
					</setBody>
					<process ref="responseHandler" />
				</otherwise>
			</choice>	
		</route>
		
		<route id="myRouteForgot">
			<from uri="cxfrs://bean://restServiceForgot" />
			 <process ref="correoProcessor" />
			<choice>
				<when>
					<simple>${property.correo} != null</simple>					
					<setHeader headerName="correo">
						<simple>${property.correo}</simple>
					</setHeader>
					<bean ref="password"/>
					<setHeader headerName="pass">
						<simple>${property.pass}</simple>
					</setHeader>
					<to uri="direct:change" />	
					<setBody>
						<simple>se envia contraseña provisional</simple>
					</setBody>
					<bean ref="mail" />
					<process ref="responseHandler" />
				</when>
				<otherwise>
					<setBody>
						<simple>error en el servicio</simple>
					</setBody>
					<process ref="responseHandler" />
				</otherwise>
			</choice>	
		</route>
		
		<route id="myRouteChange">
			<from uri="cxfrs://bean://restServiceChange" />
			 <process ref="correoProcessor2" />
			<choice>
				<when>
					<simple>${property.correo} != null</simple>					
					<setHeader headerName="correo">
						<simple>${property.correo}</simple>
					</setHeader>

					<setHeader headerName="pass">
						<simple>${property.pass}</simple>
					</setHeader>
					
					<to uri="direct:change" />	
					<setBody>
						<simple>se envia contraseña </simple>
					</setBody>
					<bean ref="mail" />
					<process ref="responseHandler" />
				</when>
				<otherwise>
					<setBody>
						<simple>error en el cambio de contraseña</simple>
					</setBody>
					<process ref="responseHandler" />
				</otherwise>
			</choice>	
		</route>
		
		
		<route id="myRouteComentario">
			<from uri="cxfrs://bean://restServiceComentario" />
			 <process ref="processor" />
			<choice>
				<when>
					<simple>${property.id} != null</simple>					
					<setHeader headerName="id">
						<simple>${property.id}</simple>
					</setHeader>
	
					<bean ref="consultasComentarios" />
					<choice>
						<when>
							<simple>${property.bandera} == 0</simple>
							<setHeader headerName="bandera">
								<simple>${property.bandera}</simple>
							</setHeader>	
							<setHeader headerName="counter">
								<simple>${property.counter}</simple>
							</setHeader>				
						</when>
						<otherwise>
							<setHeader headerName="bandera">
								<simple>${property.bandera}</simple>
							</setHeader>
							<setBody>
								<simple>no existe en la base de datos comentarios</simple>
							</setBody>
						</otherwise>
					</choice>	
					<process ref="Handler" />
				</when>
				<otherwise>
					<setHeader headerName="bandera">
						<simple>5</simple>
					</setHeader>
					<setBody>
						<simple>error</simple>
					</setBody>
					<process ref="Handler" />
				</otherwise>
			</choice>	
		</route>
		
		<route id="myRouteRegisterComentario">
			<from uri="cxfrs://bean://restServiceRegisterComentario" />
			 <process ref="correoProcessor3" />
			<choice>
				<when>
					<simple>${property.id} != null || ${property.correo} != null || ${property.contexto} != null</simple>					
					<setHeader headerName="id">
						<simple>${property.id}</simple>
					</setHeader>
					<setHeader headerName="correo">
						<simple>${property.correo}</simple>
					</setHeader>
					<setHeader headerName="contexto">
						<simple>${property.contexto}</simple>
					</setHeader>

					<bean ref="consultasComentarios2" />
					<choice>
						<when>
							<simple>${property.bandera} == 0</simple>
							<setBody>
								<simple>se registro el comentario a la bd</simple>
							</setBody>			
						</when>
						<otherwise>
							<setBody>
								<simple>no se registra comentario porque es repetido</simple>
							</setBody>
						</otherwise>
					</choice>		
						
					<process ref="responseHandler" />
				</when>
				<otherwise>
					<setHeader headerName="bandera">
						<simple>5</simple>
					</setHeader>
					<setBody>
						<simple>error</simple>
					</setBody>
					<process ref="responseHandler" />
				</otherwise>
			</choice>	
		</route>
		
		
		<route id="myRouteRegisterFoto">
			<from uri="cxfrs://bean://restServiceFoto" />
			 <process ref="correoProcessor2" />
			<choice>
				<when>
					<simple>${property.correo} != null</simple>					
					<setHeader headerName="correo">
						<simple>${property.correo}</simple>
					</setHeader>

					<setHeader headerName="pass">
						<simple>${property.pass}</simple>
					</setHeader>
					
					<bean ref="updateFoto" />
					<setBody>
						<simple>se envia foto </simple>
					</setBody>
					<process ref="responseHandler" />
				</when>
				<otherwise>
					<setBody>
						<simple>error en el envio foto</simple>
					</setBody>
					<process ref="responseHandler" />
				</otherwise>
			</choice>
		</route>
		
		<route id="myRoutePunto">
			<from uri="cxfrs://bean://restServicePunto" />
			 <process ref="correoProcessor4" />
			<choice>
				<when>
					<simple>${property.correo} != null</simple>					
					<setHeader headerName="correo">
						<simple>${property.correo}</simple>
					</setHeader>

					<setHeader headerName="puntuacion">
						<simple>${property.puntuacion}</simple>
					</setHeader>
					
					<setHeader headerName="id_inmueble">
						<simple>${property.id_inmueble}</simple>
					</setHeader>
					
					<bean ref="PuntuacionSer" />
					<choice>
						<when>
							<simple>${property.bandera} == 0</simple>
							<setBody>
								<simple>se realiza puntuacion </simple>
							</setBody>				
						</when>
						<otherwise>
							<setBody>
								<simple>no se realiza puntuacion comentario repetido</simple>
							</setBody>
						</otherwise>
					</choice>			
					<process ref="responseHandler" />
				</when>
				<otherwise>
					<setBody>
						<simple>no se realiza puntuacion</simple>
					</setBody>
					<process ref="responseHandler" />
				</otherwise>
			</choice>
		</route>
		
		
		<route id="myRouteCha">
			<from uri="direct:change" />
			<bean ref="CorreoConsultas" />
		</route>
		
		<route id="myRouteQuartz" streamCache="true">
			<from uri="quartz2://triggerPorHoras?cron=0 0 1 ? * * *" />
			<bean ref="EliminarInmueble" />
		</route>
		
	</camelContext>
</beans>